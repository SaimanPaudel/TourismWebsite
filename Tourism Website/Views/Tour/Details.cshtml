@model Tourism_Website.Models.Tour
@{
    ViewBag.Title = "Tour Details";

    // Session-based role checks (consistent with your app)
    var role = (Session["UserRole"] as string) ?? "";
    var uid = (Session["UserId"]?.ToString()) ?? "";
    bool isAdmin = role == "Admin";
    bool isAgency = role == "Agency";
    bool isGuide = role == "Guide";
    bool canManageThis =
        isAdmin ||
        (isAgency && Model.CreatedByUserId == uid) ||
        (isGuide && (Model.CreatedByUserId == uid || Model.GuideId == uid));

    // Accept either ViewBag.HostedBy (recommended) or legacy ViewBag.HostName
    var hostName = (ViewBag.HostedBy as string) ?? (ViewBag.HostName as string) ?? "—";
}

<div class="container mt-4">
    <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header text-white py-3" style="background-color:#8e4433;">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0">@Model.Title</h2>
                <div class="d-flex gap-2">
                    <a href="@Url.Action("Index","Tour")" class="btn btn-outline-light">
                        <i class="fa fa-arrow-left"></i> Back to List
                    </a>
                    @if (canManageThis)
                    {
                        <a href="@Url.Action("Edit","Tour", new { id = Model.Id })" class="btn btn-outline-light">
                            <i class="fa fa-pen"></i> Edit
                        </a>
                        <a href="@Url.Action("Delete","Tour", new { id = Model.Id })" class="btn btn-outline-light">
                            <i class="fa fa-trash"></i> Delete
                        </a>
                    }
                </div>
            </div>
        </div>

        <div class="card-body p-4">
            <div class="row g-4">
                <div class="col-lg-5">
                    @if (!string.IsNullOrEmpty(Model.ImagePath))
                    {
                        <img src="@Url.Content(Model.ImagePath)" alt="@Model.Title"
                             style="width:100%; height:320px; object-fit:cover; border-radius:12px;" />
                    }
                    else
                    {
                        <div class="d-flex align-items-center justify-content-center"
                             style="height:320px; background:#eee; border-radius:12px;">
                            <span class="text-muted">No Image</span>
                        </div>
                    }
                </div>

                <div class="col-lg-7">
                    <p class="text-muted mb-2">
                        <i class="fa fa-map-marker-alt"></i> @Model.Destination
                    </p>

                    <p class="mb-3">@Model.Description</p>

                    <div class="mb-3 d-flex flex-wrap gap-2">
                        <span class="badge" style="background-color:#fdd835; color:#000; font-size:14px;">
                            💰 @String.Format("{0:C}", Model.Price) AUD
                        </span>
                        <span class="badge bg-secondary">⏳ @Model.DurationDays Days</span>
                        <span class="badge" style="background:#8e4433;">Hosted by @hostName</span>
                    </div>

                    <div class="small text-muted mb-2">
                        <span class="me-3"><strong>Created:</strong> @Model.CreatedAt.ToString("yyyy-MM-dd HH:mm")</span>
                    </div>

                    <div class="d-flex flex-wrap gap-2 mt-3">
                        <a href="@Url.Action("Index","Feedback", new { tourId = Model.Id })" class="btn feedback-view-btn">
                            <i class="fa fa-comments"></i> View Feedback
                        </a>

                        @if (!string.IsNullOrEmpty(role))
                        {
                            if (role == "Tourist")
                            {
                                <a href="@Url.Action("Create","Feedback", new { tourId = Model.Id })" class="btn feedback-leave-btn">
                                    <i class="fa fa-comment-dots"></i> Leave Feedback
                                </a>
                            }
                            <a href="@Url.Action("Create","Booking", new { tourId = Model.Id })" class="btn book-btn">
                                <i class="fa fa-ticket-alt"></i> Book Now
                            </a>
                        }
                        else
                        {
                            <a href="@Url.Action("Login","Account")" class="btn login-book-btn">
                                <i class="fa fa-sign-in-alt"></i> Login to Book
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* brand buttons */
    .btn {
        background-color: #8e4433 !important;
        color: #fff !important;
        border: none !important;
        transition: background-color .3s;
    }

    .btn-outline-light {
        background: transparent !important;
        border: 1px solid #fff !important;
        color: #fff !important;
    }

        .btn-outline-light:hover {
            background: rgba(255,255,255,.15) !important;
        }

    .book-btn {
        background-color: #8e4433 !important;
    }

        .book-btn:hover, .login-book-btn:hover {
            background-color: green !important;
        }

    .feedback-view-btn:hover {
        background-color: #5c6bc0 !important;
    }

    .feedback-leave-btn {
        background-color: #8e4433 !important;
    }

        .feedback-leave-btn:hover {
            background-color: #2e7d32 !important;
        }

    .btn i {
        margin-right: 5px;
    }
</style>
